<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LSystems</title>
    <script src="core/generator.js"></script>
    <script src="core/curve_storage.js"></script>
    <script src="display/turtle.js"></script>
    <script src="display/three_js.js"></script>
    <script src="widgets/curve_chooser.js"></script>
    <link rel="stylesheet" href="style.css">

</head>
<body>

    <div id="wrap">
        <div id="controls">
            <label>
                Axiom: <input id="axiom" type="text">
            </label>

            <div class="inline">
                <label>
                    Angle: <input id="angle" class="small" type="number">
                </label>
                <label>
                    Depth: <input id="depth" class="small" type="number">
                </label>
                <label>
                    Step: <input id="step" class="small" type="number">
                </label>
            </div>

            <label>
                Rules: <textarea></textarea>
            </label>

            <fieldset>
                <legend>Operations</legend>
                <label>
                    Forward: <input id="forward" type="text">
                </label>
                <div class="inline">
                    <label>
                        XY+: <input class="small" id="XY+" type="text">
                    </label>
                    <label>
                        XY-: <input class="small" id="XY-" type="text">
                    </label>
                </div>
            </fieldset>

            <label>
                <input type="button" value="Render">
            </label>

            <div id="chooser">
                <label>
                    Load Curve: </br>
                    <select id="chooser_select"></select>
                    <input id="chooser_button" type="button" value="Load">
                </label>
            </div>
        </div>

        <div id="container">
            <div id="log"></div>
        </div>
    </div>
    <script type="importmap">
			{
				"imports": {
					"three": "/bin/threejs/three.module.js"
				}
			}
    </script>

    <script type="module">

        ///////////////////////////
        //Core Setup
        ///////////////////////////
        import * as THREE from 'three';
        import { OrbitControls } from '/bin/threejs/controls/OrbitControls.js';

        const container = document.getElementById("container")
        const display = new ThreeJsDisplay(THREE, OrbitControls, container)
        container.prepend(display.renderer.domElement);


        function animate() {
            requestAnimationFrame( animate );
            display.update()
        }
        animate()

        ///////////////////////////
        //Core / UI interface
        ///////////////////////////
        const log = document.getElementById('log')
        var create_curve = function(){
            const gen = new Generator({"F":"F+F−F−F+F"}, "F", 2)
            log.textContent = '';
            while(gen.hasNext()){
                let symbol = gen.step()
                if(symbol){
                    log.textContent = log.textContent + symbol;
                }

                switch (symbol){
                    case 'F':
                        display.forwardXY(5);
                        break;
                    case '−':
                        display.turnXY(-90);
                        break;
                    case '+':
                        display.turnXY(90);
                        break;
                }
            }
        }

        create_curve()

        ///////////////////////////
        //Curve Storage and Choice
        ///////////////////////////
        var curve_storage = new CurveStorage()
        curve_storage.addCurve('snowflake', "Snowflake")
        curve_storage.addCurve('dragon', "Dragon")


        var chooser_select = document.getElementById("chooser_select")
        var chooser_button = document.getElementById("chooser_button")
        curve_chooser(curve_storage, chooser_select)
        chooser_button.onclick = (function(e){
            console.log(chooser_select.value)
        })

;

    </script>
</body>
</html>